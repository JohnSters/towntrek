@using TownTrek.Models
@using TownTrek.Models.ViewModels
@{
    var isAuthenticated = User?.Identity?.IsAuthenticated == true;
    var firstName = ViewData["UserFirstName"]?.ToString();
    var lastName = ViewData["UserLastName"]?.ToString();
    var fullName = ViewData["UserFullName"]?.ToString();
    var firstInitial = !string.IsNullOrEmpty(firstName) ? firstName.Substring(0, 1).ToUpper() : "U";
    var lastInitial = !string.IsNullOrEmpty(lastName) ? lastName.Substring(0, 1).ToUpper() : "";
    var initials = (firstInitial + lastInitial);

    string displayName = isAuthenticated ? (fullName ?? "User") : "Guest User";
    string displayRole;
    if (ViewData["UserSubscriptionTier"] is SubscriptionTier tier)
    {
        displayRole = tier.DisplayName;
    }
    else
    {
        // Fallback for admin pages or when tier isn't available
        displayRole = isAuthenticated
            ? ((User != null && User.IsInRole("Admin")) ? "System Admin" : "Free Tier")
            : "Free Tier";
    }
}

@await Component.InvokeAsync("TopUserMenu")
