@model TownTrek.Models.ViewModels.AddBusinessViewModel
@{
    ViewData["Title"] = "Edit Business";
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/features/business/bundle.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/business/edit-business.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/modules/business/business-form-manager.js" asp-append-version="true"></script>
}

@if (Model == null)
{
    <div class="alert alert-error">
        <h3>Error: Business not found</h3>
        <p>The business you're trying to edit was not found or you don't have permission to edit it.</p>
    </div>
    return;
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <div>
            <h1 class="page-title">Edit Business</h1>
            <p class="page-description">Update your business listing information.</p>
        </div>
        <div class="page-actions">
            <a asp-controller="Business" asp-action="ManageBusinesses" class="auth-btn auth-btn-secondary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to My Businesses
            </a>
        </div>
    </div>
</div>

<!-- Edit Business Form -->
<div class="admin-card">
    <div class="admin-card-header">
        <h3 class="admin-card-title">Edit Business Information</h3>
        <p class="admin-card-description">Update the details below to modify your business listing</p>
    </div>
    
    <form class="edit-business-form" method="post" enctype="multipart/form-data" asp-controller="Business" asp-action="Edit" asp-route-id="@Model.Id">
        @Html.AntiForgeryToken()
        <input type="hidden" name="Id" value="@Model.Id" />
        
        <!-- Step 1: Basic Information -->
        <div class="form-section">
            <div class="form-section-header">
                <h4 class="form-section-title">
                    <span class="step-number">1</span>
                    Basic Information
                </h4>
                <p class="form-section-description">Essential details about your business</p>
            </div>       
     
            <div class="form-grid">
                <div class="form-group">
                    <label for="businessName" class="form-label required">Business Name</label>
                    <input type="text" id="businessName" name="BusinessName" class="form-input" placeholder="Enter your business name" value="@Model.BusinessName" required>
                    <span class="form-help">This will be displayed as your main business title</span>
                </div>

                <div class="category-fields">
                    <div class="form-group">
                        <label for="businessCategory" class="form-label required">Business Category</label> 
                       <select id="businessCategory" name="BusinessCategory" class="form-select" required>
                            <option value="">Select a category</option>
                            <option value="shops-retail" selected="@(Model.BusinessCategory == "shops-retail")">Shops & Retail</option>
                            <option value="restaurants-food" selected="@(Model.BusinessCategory == "restaurants-food")">Restaurants & Food Services</option>
                            <option value="markets-vendors" selected="@(Model.BusinessCategory == "markets-vendors")">Markets & Vendors</option>
                            <option value="accommodation" selected="@(Model.BusinessCategory == "accommodation")">Accommodation</option>
                            <option value="tours-experiences" selected="@(Model.BusinessCategory == "tours-experiences")">Tours & Experiences</option>
                            <option value="events" selected="@(Model.BusinessCategory == "events")">Events</option>
                        </select>
                        <span class="form-help">Choose the category that best describes your business</span>
                    </div>

                    <div id="subCategoryContainer" class="form-group" style="display: @(!string.IsNullOrEmpty(Model.SubCategory) ? "block" : "none");">
                        <label for="subCategory" class="form-label">Sub Category</label>
                        <select id="subCategory" name="SubCategory" class="form-select" data-current-value="@Model.SubCategory">
                            <option value="">Select a subcategory (optional)</option>
                        </select>
                        <span class="form-help">Choose a more specific category if available</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="townId" class="form-label required">Town/Location</label>
                    <select id="townId" name="TownId" class="form-select" required>
                        <option value="">Select your town</option>
                        @foreach (var town in Model.AvailableTowns)
                        {
                            <option value="@town.Id" selected="@(Model.TownId == town.Id)">@town.Name, @town.Province</option>
                        }
                    </select>
                    <span class="form-help">Select the town where your business is located</span>
                </div>

                <div class="form-group form-group-full">
                    <label for="businessDescription" class="form-label required">Business Description</label>
                    <textarea id="businessDescription" name="BusinessDescription" class="form-textarea" rows="4" placeholder="Describe your business, services, and what makes you unique..." required>@Model.BusinessDescription</textarea>
                    <span class="form-help">Provide a detailed description to help customers understand your business</span>
                </div>

                <div class="form-group form-group-full">
                    <label for="shortDescription" class="form-label">Short Description</label>
                    <textarea id="shortDescription" name="ShortDescription" class="form-textarea" rows="2" placeholder="Brief summary for listings (optional)">@Model.ShortDescription</textarea>
                    <span class="form-help">Optional - A brief summary that appears in business listings</span>
                </div>
            </div>
        </div>        <!
-- Step 2: Contact Information -->
        <div class="form-section">
            <div class="form-section-header">
                <h4 class="form-section-title">
                    <span class="step-number">2</span>
                    Contact Information
                </h4>
                <p class="form-section-description">How customers can reach you</p>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="phoneNumber" class="form-label required">Primary Phone Number</label>
                    <input type="tel" id="phoneNumber" name="PhoneNumber" class="form-input" placeholder="+27 21 123 4567" value="@Model.PhoneNumber" required>
                    <span class="form-help">Include country code for international visibility</span>
                </div>

                <div class="form-group">
                    <label for="phoneNumber2" class="form-label">Secondary Phone Number</label>
                    <input type="tel" id="phoneNumber2" name="PhoneNumber2" class="form-input" placeholder="+27 21 123 4568" value="@Model.PhoneNumber2">
                    <span class="form-help">Optional - Alternative contact number</span>
                </div>

                <div class="form-group">
                    <label for="emailAddress" class="form-label">Email Address</label>
                    <input type="email" id="emailAddress" name="EmailAddress" class="form-input" placeholder="info@yourbusiness.co.za" value="@Model.EmailAddress">
                    <span class="form-help">Optional - for customer inquiries</span>
                </div>

                <div class="form-group">
                    <label for="website" class="form-label">Website</label>
                    <input type="url" id="website" name="Website" class="form-input" placeholder="https://www.yourbusiness.co.za" value="@Model.Website">
                    <span class="form-help">Optional - your business website or social media page</span>
                </div>

                <div class="form-group form-group-full">
                    <label for="physicalAddress" class="form-label required">Physical Address</label>
                    <textarea id="physicalAddress" name="PhysicalAddress" class="form-textarea" rows="3" placeholder="123 Main Street, Town Center, Postal Code" required>@Model.PhysicalAddress</textarea>
                    <span class="form-help">Full street address where customers can find you</span>
                    <input type="hidden" name="Latitude" value="@Model.Latitude" />
                    <input type="hidden" name="Longitude" value="@Model.Longitude" />
                </div>
            </div>
        </div>        <!-
- Step 3: Operating Hours -->
        <div class="form-section">
            <div class="form-section-header">
                <h4 class="form-section-title">
                    <span class="step-number">3</span>
                    Operating Hours
                </h4>
                <p class="form-section-description">When customers can visit or contact you</p>
            </div>
            
            <div class="operating-hours-grid">
                @for (int i = 0; i < Model.BusinessHours.Count; i++)
                {
                    var dayHour = Model.BusinessHours[i];
                    <div class="day-hours-group">
                        <div class="day-header">
                            <input type="hidden" name="BusinessHours[@i].DayOfWeek" value="@dayHour.DayOfWeek" />
                            <input type="hidden" name="BusinessHours[@i].DayName" value="@dayHour.DayName" />
                            <input type="checkbox" id="day_@i" name="BusinessHours[@i].IsOpen" value="true" class="day-checkbox" checked="@dayHour.IsOpen">
                            <input type="hidden" name="BusinessHours[@i].IsOpen" value="false" />
                            <label for="day_@i" class="day-label">@dayHour.DayName</label>
                        </div>
                        <div class="time-inputs">
                            <input type="time" name="BusinessHours[@i].OpenTime" class="time-input" value="@dayHour.OpenTime" @(!dayHour.IsOpen ? "disabled" : "")>
                            <span class="time-separator">to</span>
                            <input type="time" name="BusinessHours[@i].CloseTime" class="time-input" value="@dayHour.CloseTime" @(!dayHour.IsOpen ? "disabled" : "")>
                        </div>
                    </div>
                }
            </div>
        </div>        
<!-- Step 4: Current Business Images -->
        @if (Model.ExistingBusinessImages != null && Model.ExistingBusinessImages.Any())
        {
            <div class="form-section current-images-section">
                <div class="form-section-header">
                    <h4 class="form-section-title">
                        <span class="step-number">4</span>
                        Current Images
                    </h4>
                    <p class="form-section-description">Your current business images - click the remove button to delete</p>
                </div>
                
                <div class="current-images-grid">
                    @foreach (var image in Model.ExistingBusinessImages)
                    {
                        <div class="current-image-item" data-image-id="@image.Id">
                            <img src="@image.ImageUrl" alt="@image.AltText" class="current-image">
                            <div class="current-image-overlay">
                                <button type="button" class="remove-image-btn" data-image-id="@image.Id">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <span class="image-type-badge">@image.ImageType</span>
                        </div>
                    }
                </div>
            </div>
        } 
       <!-- Step 5: Upload New Images -->
        <div class="form-section">
            <div class="form-section-header">
                <h4 class="form-section-title">
                    <span class="step-number">5</span>
                    Upload New Images
                </h4>
                <p class="form-section-description">Add or replace business images</p>
            </div>
            
            <div class="image-upload-section">
                <div class="form-group">
                    <label for="businessLogo" class="form-label">Business Logo</label>
                    <div class="file-upload-area" id="logoUploadArea">
                        <input type="file" id="businessLogo" name="BusinessLogo" accept="image/*" class="file-input">
                        <div class="file-upload-content">
                            <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="upload-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="upload-text">Click to upload new business logo</p>
                            <p class="upload-hint">PNG, JPG up to 2MB</p>
                        </div>
                    </div>
                    <div id="logoPreview" class="image-preview-container"></div>
                </div>

                <div class="form-group form-group-full">
                    <label for="businessImages" class="form-label">Business Photos</label>
                    <div class="file-upload-area" id="imagesUploadArea">
                        <input type="file" id="businessImages" name="BusinessImages" accept="image/*" multiple class="file-input">
                        <div class="file-upload-content">
                            <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="upload-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="upload-text">Click to upload additional business photos</p>
                            <p class="upload-hint">Multiple images allowed - PNG, JPG up to 2MB each</p>
                        </div>
                    </div>
                    <div id="imagesPreview" class="image-preview-container"></div>
                    <span class="form-help">Upload photos of your business, products, or services</span>
                </div>
            </div>
        </div> 
       <!-- Step 6: Services -->
        <div class="form-section">
            <div class="form-section-header">
                <h4 class="form-section-title">
                    <span class="step-number">6</span>
                    Services & Features
                </h4>
                <p class="form-section-description">What services do you offer?</p>
            </div>
            
            <div class="form-grid">
                <div class="form-group form-group-full">
                    <label class="form-label">Services Offered</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="delivery" class="service-checkbox" checked="@(Model.Services.Contains("delivery"))">
                            <span class="checkbox-label">Delivery Available</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="takeaway" class="service-checkbox" checked="@(Model.Services.Contains("takeaway"))">
                            <span class="checkbox-label">Takeaway/Collection</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="wheelchair" class="service-checkbox" checked="@(Model.Services.Contains("wheelchair"))">
                            <span class="checkbox-label">Wheelchair Accessible</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="parking" class="service-checkbox" checked="@(Model.Services.Contains("parking"))">
                            <span class="checkbox-label">Parking Available</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="wifi" class="service-checkbox" checked="@(Model.Services.Contains("wifi"))">
                            <span class="checkbox-label">Free WiFi</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="Services" value="cards" class="service-checkbox" checked="@(Model.Services.Contains("cards"))">
                            <span class="checkbox-label">Card Payments Accepted</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        @await Html.PartialAsync("_CategorySections", Model)

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="button" class="auth-btn auth-btn-secondary" onclick="history.back()">
                Cancel
            </button>
            <button type="submit" class="auth-btn auth-btn-cta">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                <span>Update Business Listing</span>
            </button>
        </div>
    </form>
</div>