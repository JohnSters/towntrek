@model dynamic
@{
    ViewData["Title"] = "Advanced Analytics";
    ViewData["ActivePage"] = "AdvancedAnalytics";
}

@section Styles {
    <link rel="stylesheet" href="~/css/features/client/analytics-core.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-charts.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-realtime.css" asp-append-version="true" />
}

<div class="advanced-analytics-container">
    <div class="page-header">
        <h1 class="page-title">Advanced Analytics</h1>
        <p class="page-description">Predictive insights, anomaly detection, and custom metrics for your business performance.</p>
        <div class="page-actions">
            <button type="button" id="generateTestData" class="btn btn-outline-secondary btn-sm">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
                Generate Test Data
            </button>
        </div>
    </div>

    <!-- Predictive Analytics Section -->
    <div class="analytics-section">
        <div class="section-header">
            <h2 class="section-title">Predictive Analytics</h2>
            <div class="section-actions">
                <select id="forecastPeriod" class="form-select form-select-sm">
                    <option value="7">7 days</option>
                    <option value="30" selected>30 days</option>
                    <option value="90">90 days</option>
                    <option value="365">1 year</option>
                </select>
                <button type="button" id="refreshPredictive" class="btn btn-primary btn-sm">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <div class="predictive-content">
            <div class="loading-spinner" id="predictiveLoading" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div id="predictiveData" class="predictive-data">
                <!-- Predictive data will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Anomaly Detection Section -->
    <div class="analytics-section">
        <div class="section-header">
            <h2 class="section-title">Anomaly Detection</h2>
            <div class="section-actions">
                <select id="anomalyPeriod" class="form-select form-select-sm">
                    <option value="7">7 days</option>
                    <option value="30" selected>30 days</option>
                    <option value="90">90 days</option>
                </select>
                <button type="button" id="refreshAnomalies" class="btn btn-primary btn-sm">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <div class="anomaly-content">
            <div class="loading-spinner" id="anomalyLoading" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div id="anomalyData" class="anomaly-data">
                <!-- Anomaly data will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Custom Metrics Section -->
    <div class="analytics-section">
        <div class="section-header">
            <h2 class="section-title">Custom Metrics</h2>
            <div class="section-actions">
                <button type="button" id="createMetric" class="btn btn-primary btn-sm">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create Metric
                </button>
                <button type="button" id="refreshMetrics" class="btn btn-outline-primary btn-sm">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <div class="metrics-content">
            <div class="loading-spinner" id="metricsLoading" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div id="metricsData" class="metrics-data">
                <!-- Custom metrics data will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Create Metric Modal -->
<div class="modal fade" id="createMetricModal" tabindex="-1" aria-labelledby="createMetricModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createMetricModalLabel">Create Custom Metric</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createMetricForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="metricName" class="form-label">Metric Name</label>
                                <input type="text" class="form-control" id="metricName" name="Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="metricCategory" class="form-label">Category</label>
                                <select class="form-select" id="metricCategory" name="Category" required>
                                    <option value="">Select Category</option>
                                    <option value="Views">Views</option>
                                    <option value="Engagement">Engagement</option>
                                    <option value="Revenue">Revenue</option>
                                    <option value="Performance">Performance</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="metricDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="metricDescription" name="Description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="metricFormula" class="form-label">Formula</label>
                                <input type="text" class="form-control" id="metricFormula" name="Formula" required>
                                <div class="form-text">Use variables like {views}, {reviews}, {favorites} in your formula</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="metricUnit" class="form-label">Unit</label>
                                <input type="text" class="form-control" id="metricUnit" name="Unit" placeholder="e.g., %, count, $">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveMetric">Create Metric</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Analytics scripts are already loaded in _ClientLayout.cshtml -->
}
