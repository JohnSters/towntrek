@model TownTrek.Models.ViewModels.BusinessAnalyticsData
@{
    ViewData["Title"] = $"Analytics - {Model.BusinessName}";
    Layout = "_ClientLayout";
}

<div class="business-analytics">
    <!-- Header -->
    <div class="analytics-header">
        <div class="header-content">
            <nav class="breadcrumb">
                <a asp-controller="Analytics" asp-action="Index">Analytics</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">@Model.BusinessName</span>
            </nav>
            <p class="page-subtitle">Detailed performance metrics and insights</p>
        </div>
        <div class="business-status">
            <span class="status-badge @Model.Status.ToLower()">@Model.Status</span>
            <span class="category-badge">@Model.Category</span>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="business-metrics">
        <div class="metrics-grid">
            <div class="metric-card primary">
                <div class="metric-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.TotalViews.ToString("N0")</div>
                    <div class="metric-label">Total Views</div>
                    <div class="metric-period">
                        This month: @Model.ViewsThisMonth | Last month: @Model.ViewsLastMonth
                    </div>
                </div>
            </div>

            <div class="metric-card secondary">
                <div class="metric-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                    </svg>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.AverageRating.ToString("F1")</div>
                    <div class="metric-label">Average Rating</div>
                    <div class="metric-period">
                        @Model.TotalReviews reviews total
                    </div>
                </div>
            </div>

            <div class="metric-card accent">
                <div class="metric-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.TotalFavorites</div>
                    <div class="metric-label">Favorites</div>
                    <div class="metric-period">
                        This month: @Model.FavoritesThisMonth
                    </div>
                </div>
            </div>

            <div class="metric-card performance">
                <div class="metric-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.EngagementScore.ToString("F1")%</div>
                    <div class="metric-label">Engagement Score</div>
                    <div class="metric-trend @Model.PerformanceTrend">
                        @(Model.PerformanceTrend == "up" ? "↗ Trending up" : Model.PerformanceTrend == "down" ? "↘ Trending down" : "→ Stable")
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations -->
    @if (Model.Recommendations.Any())
    {
        <div class="business-recommendations">
            <div class="section-header">
                <h2>Recommendations</h2>
                <p>Actionable insights to improve your business performance</p>
            </div>
            
            <div class="recommendations-list">
                @foreach (var recommendation in Model.Recommendations)
                {
                    <div class="recommendation-item">
                        <div class="recommendation-icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <div class="recommendation-content">
                            <p>@recommendation</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Actions -->
    <div class="business-actions">
        <div class="actions-grid">
            <a asp-controller="Business" asp-action="Edit" asp-route-id="@Model.BusinessId" class="action-card">
                <div class="action-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </div>
                <div class="action-content">
                    <h3>Edit Business</h3>
                    <p>Update information and improve visibility</p>
                </div>
            </a>

            <a asp-controller="Image" asp-action="MediaGallery" class="action-card">
                <div class="action-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div class="action-content">
                    <h3>Manage Images</h3>
                    <p>Add photos to attract more customers</p>
                </div>
            </a>

            <a href="#" class="action-card" onclick="alert('Feature coming soon!')">
                <div class="action-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                </div>
                <div class="action-content">
                    <h3>Share Analytics</h3>
                    <p>Export or share performance data</p>
                </div>
            </a>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/features/client/business-analytics.css" asp-append-version="true" />
}

@section Scripts {
    <script>
        // Simple page-specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Animate metric values
            const metricValues = document.querySelectorAll('.metric-value');
            metricValues.forEach(value => {
                const text = value.textContent;
                const number = parseFloat(text.replace(/[^0-9.]/g, ''));
                if (!isNaN(number) && number > 0) {
                    let current = 0;
                    const increment = number / 30;
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= number) {
                            value.textContent = text;
                            clearInterval(timer);
                        } else {
                            if (text.includes('.')) {
                                value.textContent = current.toFixed(1);
                            } else {
                                value.textContent = Math.floor(current).toLocaleString();
                            }
                        }
                    }, 50);
                }
            });
        });
    </script>
}