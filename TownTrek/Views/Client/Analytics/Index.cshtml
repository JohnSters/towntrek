@model TownTrek.Models.ViewModels.ClientAnalyticsViewModel
@{
    ViewData["Title"] = "Analytics Dashboard";
    Layout = "_ClientLayout";
}

<div class="analytics-dashboard">
    <!-- Header -->
    <div class="analytics-header">
        <div class="header-content">
            <p class="page-subtitle">Track your business performance and customer engagement</p>
        </div>
    </div>

    @if (ViewBag.NoBusinesses == true)
    {
        <div class="empty-state">
            <div class="empty-icon" aria-hidden="true">
                <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-6a2 2 0 012-2h8m-6 8h6" />
                </svg>
            </div>
            <h2>No businesses yet</h2>
            <p>Add your first business to start seeing analytics.</p>
            <a href="@Url.Action("Create", "Business")" class="btn btn-primary">Add a Business</a>
        </div>
    }
    else
    {
        <!-- Analytics Overview Cards -->
        <div class="analytics-overview">
            <div class="overview-cards">
                <div class="overview-card">
                    <div class="card-icon views">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </div>
                    <div class="card-content">
                        <div class="card-value">@Model.Overview.TotalViews.ToString("N0")</div>
                        <div class="card-label">Total Views</div>
                        @if (Model.Overview.ViewsGrowthRate != 0)
                        {
                            <div class="card-growth @(Model.Overview.ViewsGrowthRate > 0 ? "positive" : "negative")">
                                @(Model.Overview.ViewsGrowthRate > 0 ? "+" : "")@Model.Overview.ViewsGrowthRate.ToString("F1")%
                            </div>
                        }
                    </div>
                </div>

                <div class="overview-card">
                    <div class="card-icon reviews">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                        </svg>
                    </div>
                    <div class="card-content">
                        <div class="card-value">@Model.Overview.TotalReviews</div>
                        <div class="card-label">Total Reviews</div>
                        @if (Model.Overview.OverallRating > 0)
                        {
                            <div class="card-rating">
                                @Model.Overview.OverallRating.ToString("F1") ‚≠ê
                            </div>
                        }
                    </div>
                </div>

                <div class="overview-card">
                    <div class="card-icon favorites">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <div class="card-content">
                        <div class="card-value">@Model.Overview.TotalFavorites</div>
                        <div class="card-label">Total Favorites</div>
                        @if (Model.Overview.FavoritesGrowthRate != 0)
                        {
                            <div class="card-growth @(Model.Overview.FavoritesGrowthRate > 0 ? "positive" : "negative")">
                                @(Model.Overview.FavoritesGrowthRate > 0 ? "+" : "")@Model.Overview.FavoritesGrowthRate.ToString("F1")%
                            </div>
                        }
                    </div>
                </div>

                <div class="overview-card">
                    <div class="card-icon businesses">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <div class="card-content">
                        <div class="card-value">@Model.Businesses.Count</div>
                        <div class="card-label">Active Businesses</div>
                        @if (!string.IsNullOrEmpty(Model.Overview.TopPerformingBusiness))
                        {
                            <div class="card-detail">Top: @Model.Overview.TopPerformingBusiness</div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="analytics-charts">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Views Over Time</h3>
                        <div class="chart-controls">
                            <select id="viewsTimeRange" class="form-select">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-content">
                        <canvas id="viewsChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Reviews & Ratings</h3>
                        <div class="chart-controls">
                            <select id="reviewsTimeRange" class="form-select">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-content">
                        <canvas id="reviewsChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Performance Section -->
        <div class="business-performance">
            <div class="section-header">
                <h2>Business Performance</h2>
                <p>Individual performance metrics for each of your businesses</p>
            </div>

            <div class="performance-grid">
                @foreach (var business in Model.BusinessAnalytics)
                {
                    <div class="performance-card">
                        <div class="performance-header">
                            <h4>@business.BusinessName</h4>
                            <span class="business-category">@business.Category</span>
                            <div class="performance-trend @business.PerformanceTrend">
                                @if (business.PerformanceTrend == "up")
                                {
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 17l9.2-9.2M17 17V7H7"></path>
                                    </svg>
                                }
                                else if (business.PerformanceTrend == "down")
                                {
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 7l-9.2 9.2M7 7v10h10"></path>
                                    </svg>
                                }
                                else
                                {
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"></path>
                                    </svg>
                                }
                            </div>
                        </div>

                        <div class="performance-metrics">
                            <div class="metric">
                                <span class="metric-label">Views</span>
                                <span class="metric-value">@business.TotalViews</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Reviews</span>
                                <span class="metric-value">@business.TotalReviews</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Rating</span>
                                <span class="metric-value">@(business.AverageRating > 0 ? business.AverageRating.ToString("F1") : "N/A")</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Favorites</span>
                                <span class="metric-value">@business.TotalFavorites</span>
                            </div>
                        </div>

                        @if (business.Recommendations.Any())
                        {
                            <div class="performance-recommendations">
                                <h5>Recommendations</h5>
                                <ul>
                                    @foreach (var recommendation in business.Recommendations.Take(2))
                                    {
                                        <li>@recommendation</li>
                                    }
                                </ul>
                            </div>
                        }

                        <div class="performance-actions">
                            <a href="@Url.Action("Business", new { id = business.BusinessId })" class="btn btn-secondary btn-sm">View Details</a>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Performance Insights -->
        @if (Model.PerformanceInsights.Any())
        {
            <div class="performance-insights">
                <div class="section-header">
                    <h2>Performance Insights</h2>
                    <p>AI-powered recommendations to improve your business performance</p>
                </div>

                <div class="insights-grid">
                    @foreach (var insight in Model.PerformanceInsights.Take(6))
                    {
                        <div class="insight-card @insight.InsightType">
                            <div class="insight-icon">
                                @if (insight.InsightType == "success")
                                {
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                }
                                else if (insight.InsightType == "warning")
                                {
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                }
                                else
                                {
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                }
                            </div>
                            <div class="insight-content">
                                <h4>@insight.Title</h4>
                                <p>@insight.Description</p>
                                <div class="insight-action">
                                    <strong>Action:</strong> @insight.ActionRecommendation
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Advanced Features (available to all) -->
        var showAdvanced = Model.CategoryBenchmarks != null || Model.CompetitorInsights.Any();

        @if (showAdvanced)
        {
            <div class="premium-features">
                <div class="section-header">
                    <h2>Advanced Analytics</h2>
                    <p>Category benchmarks and competitive analysis</p>
                </div>

                <div class="premium-grid">
                    @if (Model.CategoryBenchmarks != null)
                    {
                        <div class="premium-card">
                            <div class="premium-header">
                                <h3>Category Benchmarks</h3>
                            </div>
                            <div class="benchmark-content">
                                <p>Your performance vs. @Model.CategoryBenchmarks.Category category average:</p>
                                <div class="benchmark-status @Model.CategoryBenchmarks.YourPerformanceVsAverage">
                                    @Model.CategoryBenchmarks.YourPerformanceVsAverage.ToUpper()
                                </div>
                                <a href="@Url.Action("Benchmarks", new { category = Model.CategoryBenchmarks.Category })" class="btn btn-primary btn-sm">View Details</a>
                            </div>
                        </div>
                    }

                    @if (Model.CompetitorInsights.Any())
                    {
                        <div class="premium-card">
                            <div class="premium-header">
                                <h3>Competitor Analysis</h3>
                            </div>
                            <div class="competitor-content">
                                <p>Market position analysis for your business categories</p>
                                <div class="competitor-summary">
                                    @Model.CompetitorInsights.Count markets analyzed
                                </div>
                                <a href="@Url.Action("Competitors")" class="btn btn-primary btn-sm">View Analysis</a>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    }
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/features/client/analytics.css" asp-append-version="true" />
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/modules/client/analytics.js" asp-append-version="true"></script>
}