@model TownTrek.Models.ViewModels.ClientAnalyticsViewModel
@{
    ViewData["Title"] = "Analytics Dashboard";
    Layout = "_ClientLayout";
}

<div class="analytics-dashboard">
    @await Html.PartialAsync("_AnalyticsHeader", Model)
    
    @if (ViewBag.NoBusinesses != true)
    {
        @await Html.PartialAsync("_AnalyticsMetrics", Model)
        @await Html.PartialAsync("_AnalyticsCharts", Model)
        @await Html.PartialAsync("_AnalyticsBusinessPerformance", Model)
        @await Html.PartialAsync("_AnalyticsPerformanceInsights", Model)
        @await Html.PartialAsync("_AnalyticsAdvancedFeatures", Model)
    }
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/components/modal.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-core.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-charts.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-realtime.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/features/client/analytics-export.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/lib/chart.js/chart.bundle.min.js"></script>
    <script src="~/lib/signalr/signalr.min.js"></script>
    <script src="~/js/modules/client/analytics-core.js" asp-append-version="true"></script>
    <script src="~/js/modules/client/analytics-charts.js" asp-append-version="true"></script>
    <script src="~/js/modules/client/analytics-realtime.js" asp-append-version="true"></script>
    <script src="~/js/modules/client/analytics-export.js" asp-append-version="true"></script>
    
    <script>
        // Initialize analytics modules when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initialize AnalyticsCore
                const analyticsCore = new AnalyticsCore();
                analyticsCore.init();
                
                // Initialize AnalyticsCharts
                const analyticsCharts = new AnalyticsCharts(analyticsCore);
                analyticsCharts.init();
                
                // Initialize AnalyticsRealtime
                const analyticsRealtime = new AnalyticsRealtime(analyticsCore);
                analyticsRealtime.init();
                
                // Initialize AnalyticsExport and set global instance
                const analyticsExport = new AnalyticsExport(analyticsCore);
                analyticsExport.init();
                window.analyticsExport = analyticsExport; // Set global instance
                
                console.log('All analytics modules initialized successfully');
            } catch (error) {
                console.error('Error initializing analytics modules:', error);
            }
        });
    </script>
}