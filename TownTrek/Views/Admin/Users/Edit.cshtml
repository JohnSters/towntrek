@using TownTrek.Models.ViewModels
@model AdminEditUserViewModel
@{
    ViewData["Title"] = "Edit User";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <div class="page-header-content">
        <div>
            <h1 class="page-title">Edit User</h1>
            <p class="page-description">Modify user details, roles, and subscription (admin only).</p>
        </div>
        <div class="page-actions">
            <a href="@Url.Action("Index", "AdminUsers")" class="auth-btn auth-btn-secondary">
                Back to Users
            </a>
        </div>
    </div>
</div>

<form asp-action="Edit" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="Id" value="@Model.Id" />
    <div class="stats-grid">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">User Details</h3>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input class="form-input" type="text" value="@Model.Email" disabled />
            </div>
            <div class="form-group">
                <label class="form-label" for="FirstName">First Name</label>
                <input class="form-input" id="FirstName" name="FirstName" value="@Model.FirstName" />
            </div>
            <div class="form-group">
                <label class="form-label" for="LastName">Last Name</label>
                <input class="form-input" id="LastName" name="LastName" value="@Model.LastName" />
            </div>
            <div class="form-group">
                <label class="form-label" for="IsActive">Status</label>
                <select class="form-select" id="IsActive" name="IsActive">
                    @if (Model.IsActive)
                    {
                        <option value="true" selected>Active</option>
                        <option value="false">Inactive</option>
                    }
                    else
                    {
                        <option value="true">Active</option>
                        <option value="false" selected>Inactive</option>
                    }
                </select>
            </div>
        </div>

        <div class="admin-card">
            <div class="admin-card-header">
                <h3 class="admin-card-title">Role & Subscription</h3>
            </div>
            <div class="form-group">
                <label class="form-label" for="SelectedRole">Role</label>
                <select class="form-select" id="SelectedRole" name="SelectedRole">
                    @foreach (var role in Model.AvailableRoles)
                    {
                        if (string.Equals(Model.SelectedRole, role, StringComparison.OrdinalIgnoreCase))
                        {
                            <option value="@role" selected>@role</option>
                        }
                        else
                        {
                            <option value="@role">@role</option>
                        }
                    }
                </select>
                <span class="form-help">Selecting a non-client role will deactivate any active subscription.</span>
            </div>

            <div class="form-group">
                <label class="form-label" for="SelectedSubscriptionTierId">Subscription Tier</label>
                <select class="form-select" id="SelectedSubscriptionTierId" name="SelectedSubscriptionTierId">
                    @if (!Model.SelectedSubscriptionTierId.HasValue)
                    {
                        <option value="" selected>-- None --</option>
                    }
                    else
                    {
                        <option value="">-- None --</option>
                    }
                    @foreach (var t in Model.AvailableTiers)
                    {
                        if (Model.SelectedSubscriptionTierId == t.Id)
                        {
                            <option value="@t.Id" selected>@t.Name</option>
                        }
                        else
                        {
                            <option value="@t.Id">@t.Name</option>
                        }
                    }
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="PaymentStatus">Payment Status</label>
                <select class="form-select" id="PaymentStatus" name="PaymentStatus">
                    @{
                        var ps = Model.PaymentStatus;
                    }
                    @if (string.IsNullOrEmpty(ps))
                    {
                        <option value="" selected>-- Unchanged --</option>
                    }
                    else
                    {
                        <option value="">-- Unchanged --</option>
                    }
                    @if (ps == "Active")
                    {
                        <option value="Active" selected>Active</option>
                        ;
                    }
                    else
                    {
                        <option value="Active">Active</option>
                        ;
                    }
                    @if (ps == "Completed")
                    {
                        <option value="Completed" selected>Completed</option>
                        ;
                    }
                    else
                    {
                        <option value="Completed">Completed</option>
                        ;
                    }
                    @if (ps == "Pending")
                    {
                        <option value="Pending" selected>Pending</option>
                        ;
                    }
                    else
                    {
                        <option value="Pending">Pending</option>
                        ;
                    }
                    @if (ps == "Failed")
                    {
                        <option value="Failed" selected>Failed</option>
                        ;
                    }
                    else
                    {
                        <option value="Failed">Failed</option>
                        ;
                    }
                    @if (ps == "Cancelled")
                    {
                        <option value="Cancelled" selected>Cancelled</option>
                        ;
                    }
                    else
                    {
                        <option value="Cancelled">Cancelled</option>
                        ;
                    }
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="IsSubscriptionActive">Subscription Active</label>
                <select class="form-select" id="IsSubscriptionActive" name="IsSubscriptionActive">
                    @if (Model.IsSubscriptionActive)
                    {
                        <option value="true" selected>Yes</option>
                        <option value="false">No</option>
                    }
                    else
                    {
                        <option value="true">Yes</option>
                        <option value="false" selected>No</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <button type="submit" class="auth-btn auth-btn-cta">Save Changes</button>
        <a href="@Url.Action("Index")" class="auth-btn auth-btn-secondary">Cancel</a>
    </div>
</form>

