@model List<TownTrek.Models.Town>
@{
    ViewData["Title"] = "Manage Towns";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/components/modal.css" asp-append-version="true" />
}

@section Scripts {
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <div>
            <h1 class="page-title">Manage Towns</h1>
            <p class="page-description">View and manage all South African towns in the system.</p>
        </div>
        <div class="page-actions">
            <a href="@Url.Action("Create", "AdminTowns")" class="auth-btn auth-btn-cta">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add New Town
            </a>
        </div>
    </div>
</div>

<!-- Towns Statistics -->
<div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
    <div class="stat-card">
        <div class="stat-icon primary">
            <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
        </div>
        <div class="stat-value">@Model.Count</div>
        <div class="stat-label">Total Towns</div>
        <div class="stat-change">@Model.Count(t => t.IsActive) active</div>
    </div>

    <div class="stat-card">
        <div class="stat-icon success">
            <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
        </div>
        <div class="stat-value">@Model.GroupBy(t => t.Province).Count()</div>
        <div class="stat-label">Provinces</div>
        <div class="stat-change">Represented</div>
    </div>

    <div class="stat-card">
        <div class="stat-icon info">
            <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
        </div>
        <div class="stat-value">@Model.Sum(t => t.Businesses.Count)</div>
        <div class="stat-label">Total Businesses</div>
        <div class="stat-change">Across all towns</div>
    </div>
</div>

<!-- Towns Table -->
<div class="admin-card">
    <div class="admin-card-header">
        <h3 class="admin-card-title">All Towns</h3>
        <div class="admin-card-actions">
            <button class="header-btn" title="Filter">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                </svg>
            </button>
            <button class="header-btn" title="Export">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </button>
        </div>
    </div>
    
    @if (Model.Any())
    {
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Town Name</th>
                        <th>Province</th>
                        <th>Population</th>
                        <th>Postal Code</th>
                        <th>Businesses</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var town in Model)
                    {
                        <tr>
                            <td>
                                <div class="table-cell-content">
                                    <div class="table-cell-title">@town.Name</div>
                                    @if (!string.IsNullOrEmpty(town.Description))
                                    {
                                        <div class="table-cell-subtitle">@town.Description.Substring(0, Math.Min(50, town.Description.Length))@(town.Description.Length > 50 ? "..." : "")</div>
                                    }
                                    @if (!string.IsNullOrEmpty(town.Landmarks))
                                    {
                                        <div class="table-cell-subtitle">
                                            <strong>Landmarks:</strong> @town.Landmarks.Substring(0, Math.Min(60, town.Landmarks.Length))@(town.Landmarks.Length > 60 ? "..." : "")
                                        </div>
                                    }
                                </div>
                            </td>
                            <td>@town.Province</td>
                            <td>
                                @if (town.Population.HasValue)
                                {
                                    <span class="badge badge-info">@town.Population.Value.ToString("N0")</span>
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td>@(town.PostalCode ?? "-")</td>
                            <td>
                                <span class="badge badge-info">@town.Businesses.Count</span>
                            </td>
                            <td>
                                @if (town.IsActive)
                                {
                                    <span class="badge badge-success">Active</span>
                                }
                                else
                                {
                                    <span class="badge badge-secondary">Inactive</span>
                                }
                            </td>
                            <td>@town.CreatedAt.ToString("MMM dd, yyyy")</td>
                            <td>
                                <div class="table-actions">
                                    <a href="@Url.Action("Edit", "AdminTowns", new { id = town.Id })" class="table-action-btn" title="Edit">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </a>
                                    @if (town.Businesses.Count == 0)
                                    {
                                        <button class="table-action-btn danger" title="Delete" onclick="confirmDeleteTown('@town.Name', '@town.Id')">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    }
                                    else
                                    {
                                        <button class="table-action-btn disabled" title="Cannot delete - has businesses" disabled>
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="empty-state">
            <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 23 23" class="empty-state-icon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <h3 class="empty-state-title">No Towns Found</h3>
            <p class="empty-state-description">Get started by adding your first South African town to the system.</p>
            <a href="@Url.Action("Create", "AdminTowns")" class="auth-btn auth-btn-cta">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add First Town
            </a>
        </div>
    }
</div>