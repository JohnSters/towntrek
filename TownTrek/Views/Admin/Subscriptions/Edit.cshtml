@model TownTrek.Models.ViewModels.SubscriptionTierViewModel
@{
    ViewData["Title"] = "Edit Subscription Tier";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/features/admin/subscription.css" asp-append-version="true" />
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <div>
            <h1 class="page-title">Edit Subscription Tier</h1>
            <p class="page-description">Modify the details of the @Model.DisplayName subscription tier.</p>
        </div>
        <div class="page-actions">
            <a href="@Url.Action("Index")" class="auth-btn auth-btn-secondary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 23 23">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Tiers
            </a>
        </div>
    </div>
</div>

<div class="admin-card">
    <div class="admin-card-header">
        <h3 class="admin-card-title">Edit @Model.DisplayName</h3>
        @if (Model.ActiveSubscriptionsCount > 0)
        {
            <div class="alert alert-info" style="margin-top: 1rem;">
                <strong>Note:</strong> This tier has @Model.ActiveSubscriptionsCount active subscription(s). 
                Changes to limits and features will affect existing customers.
            </div>
        }
    </div>
    
    <form method="post" asp-action="Edit" class="add-business-form">
        @Html.AntiForgeryToken()
        <input asp-for="Id" type="hidden" />
        
        @if (!ViewData.ModelState.IsValid)
        {
            <div class="alert alert-error">
                <strong>Please correct the following errors:</strong>
                <ul style="margin: 0.5rem 0 0 1rem;">
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <li>@error.ErrorMessage</li>
                    }
                </ul>
            </div>
        }

        <!-- Basic Information -->
        <div class="form-section">
            <div class="form-section-header">
                <h3 class="form-section-title">
                    <span class="step-number">1</span>
                    Basic Information
                </h3>
                <p class="form-section-description">
                    Update the tier name, display name, and description.
                    @if (Model.ActiveSubscriptionsCount > 0)
                    {
                        <text><strong>Note:</strong> Name changes will affect existing customers.</text>
                    }
                </p>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label asp-for="Name" class="form-label required"></label>
                    <input asp-for="Name" class="form-input" />
                    <span asp-validation-for="Name" class="error-message"></span>
                </div>
                
                <div class="form-group">
                    <label asp-for="DisplayName" class="form-label required"></label>
                    <input asp-for="DisplayName" class="form-input" />
                    <span asp-validation-for="DisplayName" class="error-message"></span>
                </div>
                
                <div class="form-group form-group-full">
                    <label asp-for="Description" class="form-label"></label>
                    <textarea asp-for="Description" class="form-textarea" rows="3"></textarea>
                    <span asp-validation-for="Description" class="error-message"></span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Monthly Price</label>
                    <div class="form-input" style="background-color: var(--light-gray); color: var(--dark-gray);">
                        R@(Model.MonthlyPrice.ToString("N0")) /month
                    </div>
                    <div class="form-help">
                        To change the price, use the "Change Price" action from the main list. 
                        Price changes require special handling for existing customers.
                    </div>
                </div>
                
                <div class="form-group">
                    <label asp-for="SortOrder" class="form-label"></label>
                    <input asp-for="SortOrder" class="form-input" type="number" min="1" max="100" />
                    <span asp-validation-for="SortOrder" class="error-message"></span>
                    <div class="form-help">Lower numbers appear first (1 = first, 100 = last)</div>
                </div>
            </div>
        </div>

        <!-- Limits -->
        <div class="form-section">
            <div class="form-section-header">
                <h3 class="form-section-title">
                    <span class="step-number">2</span>
                    Usage Limits
                </h3>
                <p class="form-section-description">
                    Update limits for businesses, images, and PDFs. Use -1 for unlimited.
                    @if (Model.ActiveSubscriptionsCount > 0)
                    {
                        <text><strong>Warning:</strong> Reducing limits may affect existing customers.</text>
                    }
                </p>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label asp-for="MaxBusinesses" class="form-label"></label>
                    <input asp-for="MaxBusinesses" class="form-input" type="number" />
                    <span asp-validation-for="MaxBusinesses" class="error-message"></span>
                </div>
                
                <div class="form-group">
                    <label asp-for="MaxImages" class="form-label"></label>
                    <input asp-for="MaxImages" class="form-input" type="number" />
                    <span asp-validation-for="MaxImages" class="error-message"></span>
                </div>
                
                <div class="form-group">
                    <label asp-for="MaxPDFs" class="form-label"></label>
                    <input asp-for="MaxPDFs" class="form-input" type="number" />
                    <span asp-validation-for="MaxPDFs" class="error-message"></span>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="form-section">
            <div class="form-section-header">
                <h3 class="form-section-title">
                    <span class="step-number">3</span>
                    Features & Support
                </h3>
                <p class="form-section-description">
                    Select which features are included in this tier.
                    @if (Model.ActiveSubscriptionsCount > 0)
                    {
                        <text><strong>Note:</strong> Removing features will affect existing customers.</text>
                    }
                </p>
            </div>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input asp-for="HasBasicSupport" class="service-checkbox" />
                    <label asp-for="HasBasicSupport" class="checkbox-label">Basic Support</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasPrioritySupport" class="service-checkbox" />
                    <label asp-for="HasPrioritySupport" class="checkbox-label">Priority Support</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasDedicatedSupport" class="service-checkbox" />
                    <label asp-for="HasDedicatedSupport" class="checkbox-label">Dedicated Support</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasBasicAnalytics" class="service-checkbox" />
                    <label asp-for="HasBasicAnalytics" class="checkbox-label">Basic Analytics</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasAdvancedAnalytics" class="service-checkbox" />
                    <label asp-for="HasAdvancedAnalytics" class="checkbox-label">Advanced Analytics</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasFeaturedPlacement" class="service-checkbox" />
                    <label asp-for="HasFeaturedPlacement" class="checkbox-label">Featured Placement</label>
                </div>
                
                <div class="checkbox-item">
                    <input asp-for="HasPDFUploads" class="service-checkbox" />
                    <label asp-for="HasPDFUploads" class="checkbox-label">PDF Uploads</label>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div class="form-section">
            <div class="form-section-header">
                <h3 class="form-section-title">
                    <span class="step-number">4</span>
                    Status
                </h3>
                <p class="form-section-description">
                    Control whether this tier is active and available for new subscriptions.
                    @if (Model.ActiveSubscriptionsCount > 0)
                    {
                        <text><strong>Note:</strong> You cannot deactivate a tier with active subscriptions.</text>
                    }
                </p>
            </div>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input asp-for="IsActive" class="service-checkbox" disabled="@(Model.ActiveSubscriptionsCount > 0)" />
                    <label asp-for="IsActive" class="checkbox-label">
                        Active (available for new subscriptions)
                        @if (Model.ActiveSubscriptionsCount > 0)
                        {
                            <span style="color: var(--dark-gray); font-size: var(--body-xs);">
                                - Cannot disable while @Model.ActiveSubscriptionsCount customers are subscribed
                            </span>
                        }
                    </label>
                </div>
            </div>
        </div>

        <!-- Metadata -->
        @if (Model.UpdatedAt.HasValue || !string.IsNullOrEmpty(Model.UpdatedByName))
        {
            <div class="form-section">
                <div class="form-section-header">
                    <h3 class="form-section-title">
                        <span class="step-number">â„¹</span>
                        Last Updated
                    </h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Last Modified</label>
                        <div class="form-input" style="background-color: var(--light-gray); color: var(--dark-gray);">
                            @if (Model.UpdatedAt.HasValue)
                            {
                                @(Model.UpdatedAt.Value.ToString("MMM dd, yyyy 'at' HH:mm"))
                            }
                            else
                            {
                                <text>@(Model.CreatedAt.ToString("MMM dd, yyyy 'at' HH:mm")) (Created)</text>
                            }
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.UpdatedByName))
                    {
                        <div class="form-group">
                            <label class="form-label">Modified By</label>
                            <div class="form-input" style="background-color: var(--light-gray); color: var(--dark-gray);">
                                @Model.UpdatedByName
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Form Actions -->
        <div class="form-actions">
            <a href="@Url.Action("Index")" class="auth-btn auth-btn-secondary">Cancel</a>
            <button type="submit" class="auth-btn auth-btn-cta">Save Changes</button>
        </div>
    </form>
</div>